{% extends "base.html" %}{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow-sm"><div class="card-body">
      <h3 class="card-title mb-3 text-center">AI-Driven website scanner — Quick Inspect</h3>
      <p class="text-muted text-center small mb-3">Enter a target URL to scan for reflected/stored XSS and HTML injection.</p>
      <form id="scanForm" class="d-grid gap-2">
        <input class="form-control form-control-lg" name="url" placeholder="https://example.com" required>
        <div class="d-flex gap-2 mt-2">
          <input class="form-control" name="max_pages" type="number" value="20" style="max-width:120px">
          <input class="form-control" name="timeout" type="number" value="8" style="max-width:120px">
          <button class="btn btn-primary flex-fill" type="submit">Start Inspect</button>
        </div>
      </form>
      <div id="progressBox" class="mt-3 d-none">
        <div class="d-flex align-items-center gap-2"><div class="spinner-border"></div><div id="ptext">Starting…</div></div>
        <div class="progress mt-2"><div id="pbar" class="progress-bar" style="width:0%"></div></div>
      </div>
    </div></div>
    <div class="mt-3">
      <h6 class="mb-2">Recent Inspections</h6>
      <div class="list-group">
        {% for s in scans %}
          <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" href="/results/{{ s['id'] }}">
            <div class="small text-truncate" style="max-width:60%">{{ s['url'] }}</div>
            <div class="text-end"><div class="fw-bold">{{ (s['risk']*100)|int }}%</div><div class="small text-muted">{{ (s['critical_prob']*100)|int }}% critical</div></div>
          </a>
        {% else %}<div class="list-group-item text-muted">No inspections yet.</div>{% endfor %}
      </div>
    </div>
  </div>
</div>
<script>
const form=document.getElementById('scanForm'), box=document.getElementById('progressBox'), pbar=document.getElementById('pbar'), ptext=document.getElementById('ptext');
form.addEventListener('submit', async (e)=>{
  e.preventDefault(); box.classList.remove('d-none'); pbar.style.width='0%'; ptext.textContent='Starting…';
  const data={url:form.url.value, max_pages:form.max_pages.value, timeout:form.timeout.value};
  const r=await fetch('/start',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)});
  const d=await r.json(); if(!d.job){ alert(d.error||'Failed'); return; }
  const job=d.job;
  const t=setInterval(async()=>{
    const rr=await fetch('/job/'+job); const jj=await rr.json();
    if(jj.error){ clearInterval(t); alert(jj.error); return; }
    pbar.style.width=(jj.progress||0)+'%'; ptext.textContent=jj.status||'';
    if(jj.status==='done'){ clearInterval(t); window.location='/results/'+jj.scan_id; }
    if(jj.status==='error'){ clearInterval(t); alert('Scan error: '+(jj.error||'')); }
  }, 700);
});
</script>
{% endblock %}